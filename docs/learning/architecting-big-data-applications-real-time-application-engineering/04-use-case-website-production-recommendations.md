# Use Case 3: Website Production Recommendations (PR)

##### Analyze the problem
Recommendation should first be based on the product that is currently being viewed by the user. It should also consider the browsing history for the current user session context. The solution should be scalable to support thousands of online users simultaneously. The goals for this solution are as follows: It should be able to recommend in real-time within a matter of a few seconds. The recommendation should come up before the user loses interest in the product being viewed. Both information are available as part of the clickstream events generated by the browser.

##### Outline the solution
Recommendations will change rapidly as the user navigates between various web pages in an e-commerce website. Data science team will generate a model for recommending products based on the clickstream generated by the browser. E-commerce system generates clickstream data based on what the user clicks and navigates. The recommendation engine keeps track of all current clickstream events in an in-memory database. The real-time clickstream-based recommendations are pushed into a recommendation streaming queue. A recommendation service provides recommendations for any client querying the service. The user browser using an synchronous thread, will query the recommendation service for the current set of recommendations. The data science team working on past data on user behavior and coming up with recommendations by product.

##### Consider technologies
In this video, we look at the technology options we can use for the website product recommendations use case. We will use Apache Kafka as the message queue based on the selection criteria we have explored in our earlier use cases. In-memory databases can be used to store clickstream data and current recommendations. The options are too many and the features are comparative, so we will use Hazelcast.

##### Lay out the architecture
Apache Kafka will be used as a clickstream queue and Apache Spark as a recommendation machine learning engine. We will create a custom recommendation framework that will provide a web-based REST service to the e-commerce system. Hazelcast can be used as an in-memory data grid for the collection of recommendations. All of this architecture needs to go through a benchmarking exercise with actual production-like events.

##### Design key elements

| Key          | Considerations                            | Notes                                                        |
| ------------ | ----------------------------------------- | ------------------------------------------------------------ |
| Asynchronous | User behaviour prediction                 |                                                              |
| Synchronous  | website response benchmark                |                                                              |
| Recommender  | in-memory database, Hazelcast for example | - store user session info & recommendations<br />- No state inside app<br />- scale horizontally behind a load balancer<br />- purge session data |

*More Hazelcast setup specs*

- remote cache
- cluster with failover
- avoid key iteration
- use partitions



##### Best practices: Parallel processing
Store all data including session state in a central database. Design your services to be stateless. Deploy multiple instances of the services behind a load balancer. Data processing should be done in map type operations as much as possible to ensure parallelism.

